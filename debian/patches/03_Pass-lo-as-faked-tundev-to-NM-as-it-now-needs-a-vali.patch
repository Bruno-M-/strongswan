From 49e918021b16f2be8650f3aa24c464a829758b26 Mon Sep 17 00:00:00 2001
From: Martin Willi <martin@revosec.ch>
Date: Mon, 25 Jun 2012 16:02:20 +0200
Subject: [PATCH 2/2] Pass "lo" as faked tundev to NM, as it now needs a valid
 interface since 0.9

---
 src/libcharon/plugins/nm/nm_service.c |    7 ++++---
 1 files changed, 4 insertions(+), 3 deletions(-)

--- a/src/libcharon/plugins/nm/nm_service.c
+++ b/src/libcharon/plugins/nm/nm_service.c
@@ -89,11 +89,12 @@ static void signal_ipv4_config(NMVPNPlug
 	me = ike_sa->get_my_host(ike_sa);
 	handler = NM_STRONGSWAN_PLUGIN_GET_PRIVATE(plugin)->handler;
 
-	/* NM requires a tundev, but netkey does not use one. Passing an invalid
-	 * iface makes NM complain, but it accepts it without fiddling on eth0. */
+	/* NM requires a tundev, but netkey does not use one. Passing the physical
+	 * interface does not work, as NM fiddles around with it. Passing the
+	 * loopback seems to work, though... */
 	val = g_slice_new0 (GValue);
 	g_value_init (val, G_TYPE_STRING);
-	g_value_set_string (val, "none");
+	g_value_set_string (val, "lo");
 	g_hash_table_insert (config, NM_VPN_PLUGIN_IP4_CONFIG_TUNDEV, val);
 
 	val = g_slice_new0(GValue);
